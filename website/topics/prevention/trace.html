<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step-by-Step - Preventing Vulnerabilities</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/components.css">
    <style>
        .trace-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .trace-exercise {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-md);
        }
        .trace-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }
        .trace-title {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        .trace-number {
            background: var(--primary);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .trace-scenario {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
        }
        .trace-scenario h4 {
            color: #0369a1;
            margin-bottom: var(--space-sm);
        }
        .steps-container {
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        .trace-step {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
        }
        .trace-step:last-child {
            border-bottom: none;
        }
        .step-number-col {
            background: var(--gray-100);
            padding: var(--space-md);
            min-width: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--gray-600);
        }
        .step-content {
            flex: 1;
            padding: var(--space-md);
        }
        .step-description {
            font-weight: 500;
            margin-bottom: var(--space-sm);
        }
        .step-question {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-bottom: var(--space-sm);
        }
        .step-input {
            width: 100%;
            padding: var(--space-sm);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
        }
        .step-input:focus {
            border-color: var(--primary);
            outline: none;
        }
        .step-input.correct {
            border-color: var(--success);
            background: #d4edda;
        }
        .step-input.incorrect {
            border-color: var(--error);
            background: #f8d7da;
        }
        .step-feedback {
            margin-top: var(--space-sm);
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            display: none;
        }
        .step-feedback.show {
            display: block;
        }
        .step-feedback.correct {
            background: #d4edda;
            color: #155724;
        }
        .step-feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
        }
        .check-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 1rem;
            margin-top: var(--space-lg);
        }
        .check-btn:hover {
            background: var(--primary-dark);
        }
        .show-answer-btn {
            background: var(--gray-200);
            color: var(--gray-700);
            border: none;
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 1rem;
            margin-left: var(--space-sm);
        }
        .exercise-score {
            text-align: center;
            padding: var(--space-lg);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            margin-top: var(--space-lg);
            display: none;
        }
        .exercise-score.show {
            display: block;
        }
        .progress-indicator {
            background: var(--gray-100);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-xl);
            text-align: center;
        }
    </style>
</head>
<body>
    <nav class="main-nav">
        <div class="nav-brand">
            <span class="logo">üêç</span>
            <span class="brand-text">Python Learning</span>
        </div>
        <ul class="nav-links">
            <li><a href="../../index.html">Home</a></li>
            <li><a href="../index.html">Topics</a></li>
            <li><a href="../../progress.html">My Progress</a></li>
        </ul>
    </nav>

    <main class="container">
        <header class="topic-header">
            <a href="index.html" class="back-link">‚Üê Back to Preventing Vulnerabilities</a>
            <h1>Step-by-Step Exercises</h1>
            <p class="subtitle">Work through security prevention scenarios step by step</p>
        </header>

        <div class="progress-indicator">
            <span id="overall-progress">Exercise 1 of 5</span>
        </div>

        <div class="trace-container" id="exercises-container">
            <!-- Exercises populated by JavaScript -->
        </div>
    </main>

    <script src="../../js/progress.js"></script>
    <script>
        const exercises = [
            {
                id: 1,
                title: 'Firewall Configuration',
                scenario: 'A company sets up a new firewall to protect their internal network. The firewall needs to be configured to allow legitimate business traffic while blocking threats.',
                steps: [
                    {
                        description: 'Default Policy',
                        question: 'What should the firewall\'s default policy be? (Allow all / Deny all)',
                        answer: 'deny all',
                        acceptAlternatives: ['deny', 'block all', 'block', 'default deny'],
                        feedback: 'Correct! Firewalls should "deny all" by default, then explicitly allow needed traffic. This is more secure than allowing everything and trying to block specific threats.'
                    },
                    {
                        description: 'Web Server Access',
                        question: 'The company runs a public website. Which ports should be allowed INBOUND from the internet? (Give the port numbers)',
                        answer: '80 and 443',
                        acceptAlternatives: ['80, 443', '443 and 80', '80/443', 'http and https', '80 443'],
                        feedback: 'Correct! Port 80 (HTTP) and 443 (HTTPS) are needed for web traffic. Only these specific ports should be allowed to the web server.'
                    },
                    {
                        description: 'Email Server',
                        question: 'Employees need to receive external email. Which port(s) should be allowed for SMTP mail delivery?',
                        answer: '25',
                        acceptAlternatives: ['port 25', 'smtp', '25 smtp', '587'],
                        feedback: 'Correct! Port 25 is the standard SMTP port for receiving email. (Port 587 is also used for sending authenticated mail.)'
                    },
                    {
                        description: 'Internal Database',
                        question: 'The company has an internal database server. Should external internet traffic be allowed to reach it directly? (Yes/No and explain)',
                        answer: 'no',
                        acceptAlternatives: ['no - internal only', 'no, internal only', 'block', 'deny'],
                        feedback: 'Correct! Database servers should never be directly accessible from the internet. They should only accept connections from internal application servers.'
                    },
                    {
                        description: 'Outbound Traffic',
                        question: 'Should the firewall monitor outbound traffic (traffic leaving the network)? Why?',
                        answer: 'yes',
                        acceptAlternatives: ['yes - detect malware', 'yes, data exfiltration', 'yes to detect threats'],
                        feedback: 'Correct! Monitoring outbound traffic can detect malware phoning home to command servers, or data being stolen (exfiltrated) from the network.'
                    }
                ]
            },
            {
                id: 2,
                title: 'Password Policy Implementation',
                scenario: 'A company is implementing a new password policy to protect against brute-force attacks. Work through each security requirement.',
                steps: [
                    {
                        description: 'Minimum Length',
                        question: 'What minimum password length would you recommend to resist brute-force attacks? (number of characters)',
                        answer: '12',
                        acceptAlternatives: ['12 characters', 'at least 12', '12+', '14', '16', 'minimum 12'],
                        feedback: 'Correct! Modern recommendations suggest at least 12 characters. Each additional character exponentially increases the time needed to brute-force.'
                    },
                    {
                        description: 'Character Requirements',
                        question: 'List the types of characters that should be required (e.g., uppercase, etc.)',
                        answer: 'uppercase lowercase numbers symbols',
                        acceptAlternatives: ['upper lower numbers special', 'mixed case numbers symbols', 'uppercase, lowercase, numbers, special characters'],
                        feedback: 'Correct! Requiring uppercase, lowercase, numbers, and symbols significantly increases password complexity and resistance to attacks.'
                    },
                    {
                        description: 'Account Lockout',
                        question: 'After how many failed login attempts should an account be temporarily locked?',
                        answer: '5',
                        acceptAlternatives: ['3', '3-5', '5 attempts', 'three', 'five', '3 to 5'],
                        feedback: 'Correct! 3-5 failed attempts is typical. This stops automated brute-force attacks while allowing for genuine user mistakes.'
                    },
                    {
                        description: 'Lockout Duration',
                        question: 'How long should the account lockout last? (Give a time period)',
                        answer: '15 minutes',
                        acceptAlternatives: ['15 min', '30 minutes', '15-30 minutes', '10 minutes', '30 min'],
                        feedback: 'Correct! 15-30 minutes is typical. Long enough to stop attacks, short enough not to frustrate legitimate users too much.'
                    },
                    {
                        description: 'Password History',
                        question: 'Should the system prevent users from reusing their previous passwords? (Yes/No)',
                        answer: 'yes',
                        acceptAlternatives: ['yes, prevents reuse', 'yes - remember last passwords'],
                        feedback: 'Correct! Password history prevents users from cycling back to old (possibly compromised) passwords. Typically the last 5-10 passwords are remembered.'
                    }
                ]
            },
            {
                id: 3,
                title: 'Penetration Test Process',
                scenario: 'A company has hired ethical hackers to conduct a penetration test on their network. Trace through the proper process.',
                steps: [
                    {
                        description: 'Authorization',
                        question: 'Before starting, what document must be signed to make the testing legal?',
                        answer: 'written authorization',
                        acceptAlternatives: ['permission', 'authorization letter', 'consent', 'scope agreement', 'rules of engagement', 'contract'],
                        feedback: 'Correct! Written authorization (rules of engagement) must be obtained. Without this, penetration testing is illegal hacking!'
                    },
                    {
                        description: 'Reconnaissance',
                        question: 'The testers first gather information about the target. Name one method they might use.',
                        answer: 'scanning',
                        acceptAlternatives: ['port scanning', 'network scanning', 'osint', 'google dorking', 'dns lookup', 'whois', 'social engineering'],
                        feedback: 'Correct! Reconnaissance includes port scanning, DNS lookups, WHOIS queries, searching public information (OSINT), and other information gathering.'
                    },
                    {
                        description: 'Vulnerability Found',
                        question: 'The testers find an unpatched server with a known vulnerability. What should they do?',
                        answer: 'document and attempt to exploit',
                        acceptAlternatives: ['exploit it safely', 'test the vulnerability', 'attempt exploit', 'document and test'],
                        feedback: 'Correct! They should attempt to exploit it (within the agreed scope) to demonstrate the real risk, then document the finding thoroughly.'
                    },
                    {
                        description: 'Critical Finding',
                        question: 'They discover a critical vulnerability that could allow immediate database access. When should they report this?',
                        answer: 'immediately',
                        acceptAlternatives: ['straight away', 'right away', 'as soon as possible', 'now', 'urgently'],
                        feedback: 'Correct! Critical vulnerabilities should be reported immediately, not saved for the final report. The organisation needs to address severe risks right away.'
                    },
                    {
                        description: 'Final Report',
                        question: 'What should the final report include besides the vulnerabilities found?',
                        answer: 'remediation recommendations',
                        acceptAlternatives: ['fixes', 'recommendations', 'how to fix', 'solutions', 'remediation steps', 'mitigation'],
                        feedback: 'Correct! The report should include detailed remediation recommendations - not just what\'s wrong, but how to fix it, prioritised by severity.'
                    }
                ]
            },
            {
                id: 4,
                title: 'Encryption Implementation',
                scenario: 'A company needs to implement encryption to protect sensitive customer data. Work through the key decisions.',
                steps: [
                    {
                        description: 'Data at Rest',
                        question: 'What type of encryption should be used for data stored on laptop hard drives?',
                        answer: 'full disk encryption',
                        acceptAlternatives: ['disk encryption', 'fde', 'bitlocker', 'filevault', 'whole disk'],
                        feedback: 'Correct! Full disk encryption (like BitLocker or FileVault) encrypts the entire drive. If the laptop is stolen, data remains protected.'
                    },
                    {
                        description: 'Data in Transit',
                        question: 'What protocol should be used to encrypt website traffic?',
                        answer: 'https',
                        acceptAlternatives: ['tls', 'ssl', 'https/tls', 'ssl/tls'],
                        feedback: 'Correct! HTTPS (using TLS encryption) protects data as it travels between browsers and web servers, preventing interception.'
                    },
                    {
                        description: 'Remote Access',
                        question: 'Employees work from home. What should they use to securely access the company network?',
                        answer: 'vpn',
                        acceptAlternatives: ['virtual private network', 'encrypted vpn', 'vpn connection'],
                        feedback: 'Correct! A VPN creates an encrypted tunnel for all traffic between the home computer and company network, protecting it from interception.'
                    },
                    {
                        description: 'Password Storage',
                        question: 'How should passwords be stored in the company\'s database?',
                        answer: 'hashed',
                        acceptAlternatives: ['hashed and salted', 'as hashes', 'hash', 'encrypted hash', 'bcrypt', 'salted hash'],
                        feedback: 'Correct! Passwords should be hashed (one-way encryption) with a salt. This means even if the database is stolen, actual passwords cannot be recovered.'
                    },
                    {
                        description: 'Key Management',
                        question: 'Where should encryption keys be stored? (Same place as encrypted data or separate?)',
                        answer: 'separate',
                        acceptAlternatives: ['separately', 'different location', 'secure separate location', 'not with data'],
                        feedback: 'Correct! Keys must be stored separately from encrypted data. If an attacker gets both the encrypted data AND the key, the encryption is worthless.'
                    }
                ]
            },
            {
                id: 5,
                title: 'Physical Security Audit',
                scenario: 'You are conducting a physical security audit of a company\'s server room. Evaluate each aspect.',
                steps: [
                    {
                        description: 'Access Control',
                        question: 'The server room door has a standard key lock. What improvement would you recommend?',
                        answer: 'electronic access control',
                        acceptAlternatives: ['key card', 'badge reader', 'biometric', 'pin code', 'swipe card', 'rfid', 'keypad'],
                        feedback: 'Correct! Electronic access control (key cards, PINs, biometrics) provides audit trails of who entered and when. Keys can be copied without detection.'
                    },
                    {
                        description: 'Monitoring',
                        question: 'There are no cameras in or near the server room. What should be installed?',
                        answer: 'cctv',
                        acceptAlternatives: ['cameras', 'security cameras', 'video surveillance', 'cctv cameras'],
                        feedback: 'Correct! CCTV monitoring deters unauthorised access, provides evidence if incidents occur, and allows security to monitor activity in real-time.'
                    },
                    {
                        description: 'Visitor Policy',
                        question: 'A vendor needs to access the server room for maintenance. What policy should apply?',
                        answer: 'escorted at all times',
                        acceptAlternatives: ['escort required', 'must be accompanied', 'supervised', 'accompanied by staff', 'sign in and escort'],
                        feedback: 'Correct! Visitors should sign in, wear visible badges, and be escorted by authorised staff at all times. They should never be left alone in secure areas.'
                    },
                    {
                        description: 'Environmental',
                        question: 'Besides intruders, what physical threat should the server room be protected against?',
                        answer: 'fire',
                        acceptAlternatives: ['fire and water', 'environmental damage', 'flooding', 'temperature', 'power failure', 'fire/flood'],
                        feedback: 'Correct! Fire suppression systems, temperature monitoring, flood detection, and UPS (uninterruptible power supply) protect against environmental threats.'
                    },
                    {
                        description: 'Equipment Security',
                        question: 'Laptops in the office area could be stolen after hours. What physical security measure helps?',
                        answer: 'cable locks',
                        acceptAlternatives: ['kensington locks', 'security cables', 'locked cabinets', 'secure storage', 'lock to desk'],
                        feedback: 'Correct! Cable locks (Kensington locks) secure laptops to desks. Alternatively, laptops can be stored in locked cabinets overnight.'
                    }
                ]
            }
        ];

        let currentExercise = 0;

        function initExercises() {
            const container = document.getElementById('exercises-container');
            container.innerHTML = exercises.map((ex, index) => createExercise(ex, index)).join('');
            updateOverallProgress();
        }

        function createExercise(exercise, index) {
            return `
                <div class="trace-exercise" id="exercise-${index}" style="display: ${index === 0 ? 'block' : 'none'}">
                    <div class="trace-header">
                        <div class="trace-title">
                            <div class="trace-number">${exercise.id}</div>
                            <h3>${exercise.title}</h3>
                        </div>
                    </div>

                    <div class="trace-scenario">
                        <h4>Scenario</h4>
                        <p>${exercise.scenario}</p>
                    </div>

                    <div class="steps-container">
                        ${exercise.steps.map((step, stepIndex) => `
                            <div class="trace-step">
                                <div class="step-number-col">${stepIndex + 1}</div>
                                <div class="step-content">
                                    <div class="step-description">${step.description}</div>
                                    <div class="step-question">${step.question}</div>
                                    <input type="text" class="step-input" id="input-${index}-${stepIndex}" placeholder="Type your answer...">
                                    <div class="step-feedback" id="feedback-${index}-${stepIndex}"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <button class="check-btn" onclick="checkExercise(${index})">Check Answers</button>
                    <button class="show-answer-btn" onclick="showAnswers(${index})">Show Answers</button>

                    <div class="exercise-score" id="score-${index}">
                        <p id="score-text-${index}"></p>
                        ${index < exercises.length - 1 ? `<button class="check-btn" onclick="nextExercise()" style="margin-top: var(--space-md);">Next Exercise ‚Üí</button>` : ''}
                    </div>
                </div>
            `;
        }

        function checkExercise(exerciseIndex) {
            const exercise = exercises[exerciseIndex];
            let correct = 0;

            exercise.steps.forEach((step, stepIndex) => {
                const input = document.getElementById(`input-${exerciseIndex}-${stepIndex}`);
                const feedback = document.getElementById(`feedback-${exerciseIndex}-${stepIndex}`);
                const userAnswer = input.value.toLowerCase().trim();

                const isCorrect = userAnswer === step.answer.toLowerCase() ||
                    (step.acceptAlternatives && step.acceptAlternatives.some(alt => userAnswer.includes(alt.toLowerCase())));

                input.classList.remove('correct', 'incorrect');
                input.classList.add(isCorrect ? 'correct' : 'incorrect');

                feedback.classList.add('show');
                feedback.classList.remove('correct', 'incorrect');
                feedback.classList.add(isCorrect ? 'correct' : 'incorrect');
                feedback.textContent = isCorrect ? step.feedback : `Not quite. ${step.feedback}`;

                if (isCorrect) correct++;
            });

            const score = Math.round((correct / exercise.steps.length) * 100);
            const scoreDiv = document.getElementById(`score-${exerciseIndex}`);
            const scoreText = document.getElementById(`score-text-${exerciseIndex}`);

            scoreDiv.classList.add('show');
            scoreText.textContent = `You got ${correct} out of ${exercise.steps.length} correct (${score}%)`;

            Progress.saveActivity(`prevention-trace-${exerciseIndex + 1}`, 'completed', score);
        }

        function showAnswers(exerciseIndex) {
            const exercise = exercises[exerciseIndex];

            exercise.steps.forEach((step, stepIndex) => {
                const input = document.getElementById(`input-${exerciseIndex}-${stepIndex}`);
                const feedback = document.getElementById(`feedback-${exerciseIndex}-${stepIndex}`);

                input.value = step.answer;
                input.classList.add('correct');

                feedback.classList.add('show', 'correct');
                feedback.textContent = step.feedback;
            });
        }

        function nextExercise() {
            const current = document.getElementById(`exercise-${currentExercise}`);
            current.style.display = 'none';

            currentExercise++;
            const next = document.getElementById(`exercise-${currentExercise}`);
            next.style.display = 'block';

            updateOverallProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateOverallProgress() {
            document.getElementById('overall-progress').textContent =
                `Exercise ${currentExercise + 1} of ${exercises.length}`;
        }

        // Initialize
        initExercises();
        Progress.startActivity('prevention-trace', 'trace');
    </script>
</body>
</html>
