<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Progress - Python Learning</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <nav class="main-nav">
        <div class="nav-brand">
            <span class="logo">üêç</span>
            <span class="brand-text">Python Learning</span>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="topics/index.html">Topics</a></li>
            <li><a href="progress.html" class="active">My Progress</a></li>
            <li><a href="certificates.html">Certificates</a></li>
            <li><a href="help.html">Help</a></li>
        </ul>
    </nav>

    <main class="container">
        <header class="hero">
            <h1>My Progress</h1>
            <p class="hero-subtitle">Track your learning journey</p>
        </header>

        <section class="progress-overview">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-activities">0</div>
                    <div class="stat-label">Activities Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-topics">0</div>
                    <div class="stat-label">Topics Started</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="best-score">-</div>
                    <div class="stat-label">Best Quiz Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-certificates">0</div>
                    <div class="stat-label">Certificates Earned</div>
                </div>
            </div>
        </section>

        <section class="certificates-section mt-xl">
            <h2>My Certificates</h2>
            <div id="certificates-list" class="certificates-preview">
                <!-- Populated by JavaScript -->
            </div>
            <a href="certificates.html" class="btn btn-secondary mt-md">View All Certificates</a>
        </section>

        <section class="topic-progress-section mt-xl">
            <h2>Progress by Topic</h2>
            <div id="topic-progress-list" class="topic-progress-list">
                <!-- Populated by JavaScript -->
            </div>
        </section>

        <section class="recent-activity mt-xl">
            <h2>Recent Activity</h2>
            <div id="recent-activities" class="activity-list">
                <!-- Populated by JavaScript -->
            </div>
        </section>

        <section class="progress-actions mt-xl">
            <h2>Manage Progress</h2>
            <div class="action-buttons">
                <button class="btn btn-secondary" id="export-progress">
                    üì• Export Progress
                </button>
                <button class="btn btn-secondary" id="import-progress">
                    üì§ Import Progress
                </button>
                <button class="btn btn-secondary" id="reset-progress" style="color: var(--error);">
                    üóëÔ∏è Reset All Progress
                </button>
            </div>
            <input type="file" id="import-file" accept=".json" style="display: none;">
        </section>
    </main>

    <footer class="main-footer">
        <p>Built on evidence-based teaching methods from computing education research.</p>
    </footer>

    <!-- jsPDF for certificate generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/progress.js"></script>
    <script src="js/certificate.js"></script>
    <script src="js/main.js"></script>
    <script>
        const topics = [
            { id: 'variables', name: 'Variables', icon: 'üì¶' },
            { id: 'data-types', name: 'Data Types', icon: 'üè∑Ô∏è' },
            { id: 'operators', name: 'Operators', icon: '‚ûï' },
            { id: 'strings', name: 'Strings', icon: 'üìù' },
            { id: 'selection', name: 'Selection', icon: 'üîÄ' },
            { id: 'for-loops', name: 'For Loops', icon: 'üîÑ' },
            { id: 'while-loops', name: 'While Loops', icon: 'üîÅ' },
            { id: 'lists', name: 'Lists', icon: 'üìã' },
            { id: 'arrays-1d', name: '1D Arrays', icon: 'üìä' },
            { id: 'arrays-2d', name: '2D Arrays', icon: 'üóÉÔ∏è' },
            { id: 'functions', name: 'Functions', icon: '‚ö°' },
            { id: 'file-handling', name: 'File Handling', icon: 'üìÅ' },
            { id: 'errors', name: 'Error Handling', icon: 'üêõ' },
            { id: 'validation', name: 'Input Validation', icon: '‚úÖ' },
            { id: 'sql', name: 'SQL & Databases', icon: 'üóÑÔ∏è' },
            { id: 'cpu', name: 'CPU & Fetch-Execute', icon: 'üñ•Ô∏è' },
            { id: 'memory', name: 'Memory & Storage', icon: 'üíæ' },
            { id: 'storage', name: 'Secondary Storage', icon: 'üíø' },
            { id: 'units', name: 'Data Units & Capacity', icon: 'üìè' },
            { id: 'numbers', name: 'Number Systems', icon: 'üî¢' },
            { id: 'representation', name: 'Data Representation', icon: 'üé®' },
            { id: 'compression', name: 'Compression', icon: 'üì¶' },
            { id: 'networks', name: 'Computer Networks', icon: 'üåê' },
            { id: 'protocols', name: 'Protocols & Layers', icon: 'üì°' },
            { id: 'security', name: 'Network Security', icon: 'üîê' }
        ];

        function updateProgressPage() {
            const data = Progress.getAll();

            // Count completed activities
            const completedActivities = Object.values(data.activities)
                .filter(a => a.status === 'completed').length;
            document.getElementById('total-activities').textContent = completedActivities;

            // Count started topics
            const startedTopics = Object.keys(data.topics).length;
            document.getElementById('total-topics').textContent = startedTopics;

            // Find best score
            const scores = Object.values(data.activities)
                .map(a => a.bestScore)
                .filter(s => s !== null);
            const bestScore = scores.length > 0 ? Math.max(...scores) : null;
            document.getElementById('best-score').textContent = bestScore ? bestScore + '%' : '-';

            // Topic progress list
            const topicList = document.getElementById('topic-progress-list');
            topicList.innerHTML = topics.map(topic => {
                const progress = Progress.getTopicProgress(topic.id);
                return `
                    <div class="topic-progress-item">
                        <div class="topic-info">
                            <span class="topic-icon">${topic.icon}</span>
                            <span class="topic-name">${topic.name}</span>
                        </div>
                        <div class="topic-progress-bar">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress.progress}%"></div>
                            </div>
                            <span class="progress-text">${progress.progress}%</span>
                        </div>
                    </div>
                `;
            }).join('');

            // Recent activities
            const recentList = document.getElementById('recent-activities');
            const activities = Object.entries(data.activities)
                .sort((a, b) => {
                    const dateA = new Date(a[1].completedAt || a[1].startedAt);
                    const dateB = new Date(b[1].completedAt || b[1].startedAt);
                    return dateB - dateA;
                })
                .slice(0, 10);

            if (activities.length === 0) {
                recentList.innerHTML = '<p class="text-muted">No activities yet. Start learning to track your progress!</p>';
            } else {
                recentList.innerHTML = activities.map(([id, activity]) => `
                    <div class="activity-item">
                        <span class="activity-name">${id}</span>
                        <span class="status-badge ${activity.status}">${formatStatus(activity.status)}</span>
                        ${activity.bestScore !== null ? `<span class="activity-score">${activity.bestScore}%</span>` : ''}
                    </div>
                `).join('');
            }

            // Update certificates
            updateCertificatesDisplay();
        }

        function updateCertificatesDisplay() {
            const certificates = CertificateSystem.getAllCertificates();
            const certList = document.getElementById('certificates-list');
            const certCount = document.getElementById('total-certificates');

            certCount.textContent = certificates.length;

            if (certificates.length === 0) {
                certList.innerHTML = '<p class="text-muted">Complete all activities in a topic to earn a certificate!</p>';
            } else {
                // Show up to 4 most recent certificates
                const recentCerts = certificates
                    .sort((a, b) => new Date(b.earnedAt) - new Date(a.earnedAt))
                    .slice(0, 4);

                certList.innerHTML = recentCerts.map(cert => `
                    <div class="cert-preview-card">
                        <span class="cert-icon">üèÜ</span>
                        <div class="cert-info">
                            <strong>${CertificateSystem.topicNames[cert.topicId] || cert.topicId}</strong>
                            <small>${new Date(cert.earnedAt).toLocaleDateString()}</small>
                        </div>
                        <button class="btn btn-sm btn-success" onclick="CertificateSystem.downloadCertificate(CertificateSystem.getAllCertificates().find(c => c.id === '${cert.id}'))">
                            Download
                        </button>
                    </div>
                `).join('');
            }
        }

        // Export progress
        document.getElementById('export-progress').addEventListener('click', () => {
            const data = Progress.export();
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'python-learning-progress.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Progress exported!', 'success');
        });

        // Import progress
        document.getElementById('import-progress').addEventListener('click', () => {
            document.getElementById('import-file').click();
        });

        document.getElementById('import-file').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    if (Progress.import(event.target.result)) {
                        showToast('Progress imported!', 'success');
                        updateProgressPage();
                    } else {
                        showToast('Failed to import progress', 'error');
                    }
                };
                reader.readAsText(file);
            }
        });

        // Reset progress
        document.getElementById('reset-progress').addEventListener('click', () => {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                Progress.reset();
                showToast('Progress reset', 'info');
                updateProgressPage();
            }
        });

        // Initialize
        updateProgressPage();
    </script>
    <style>
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-lg);
        }
        .stat-card {
            background: white;
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: var(--shadow-sm);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        .stat-label {
            color: var(--gray-600);
            font-size: 0.9rem;
        }
        .topic-progress-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        .topic-progress-item {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            padding: var(--space-md);
            background: white;
            border-radius: var(--radius-md);
        }
        .topic-info {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            min-width: 150px;
        }
        .topic-progress-bar {
            flex: 1;
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        .topic-progress-bar .progress-bar {
            flex: 1;
        }
        .activity-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: white;
            border-radius: var(--radius-md);
        }
        .activity-name {
            flex: 1;
        }
        .activity-score {
            font-weight: bold;
            color: var(--success);
        }
        .action-buttons {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
        }
        .certificates-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--space-md);
        }
        .cert-preview-card {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: linear-gradient(135deg, #fef9e7 0%, #fcf3cf 100%);
            border-radius: var(--radius-md);
            border: 2px solid #f4d03f;
        }
        .cert-icon {
            font-size: 1.5rem;
        }
        .cert-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .cert-info small {
            color: var(--gray-600);
        }
        .btn-sm {
            padding: var(--space-xs) var(--space-sm);
            font-size: 0.8rem;
        }
    </style>
</body>
</html>
